Сделал, что смог. С DMA не смог разобраться.